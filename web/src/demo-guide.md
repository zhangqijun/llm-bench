# TPS压测系统使用指南

## 功能概述

TPS压测系统现在包含了完整的压测流程，从配置参数到查看美观的结果报告。

## 主要功能

### 1. 压测配置
- **模型选择**：支持自动获取可用模型列表
- **API配置**：支持多种后端（vLLM、SGLang、Ollama等）
- **参数设置**：并发数、Token范围、数据集选择
- **API密钥**：支持需要认证的API

### 2. 一键压测
- 点击"开始测试"按钮即可启动完整的性能压测
- 自动收集所有配置参数
- 调用后端perf模块进行实际压测
- 压测完成后自动跳转到结果页面

### 3. 美观的结果展示
- **测试配置信息**：显示本次测试的所有参数
- **核心性能指标**：TPS、RPS、响应时间、成功率等
- **可视化图表**：
  - 响应时间分布柱状图
  - 响应时间百分位数折线图
  - 性能指标雷达图
- **性能评级**：自动计算吞吐量、延迟、稳定性评级
- **结果导出**：支持导出JSON格式的详细结果

## 使用步骤

### 步骤1：配置测试参数
1. 访问 `http://localhost:8080/tps-test.html`
2. 选择后端类型（vLLM、SGLang等）
3. 配置API URL（会自动填充默认值）
4. 选择模型（会自动获取可用模型列表）
5. 设置Token范围（最小/最大Token数）
6. 选择数据集（openqa、longalpaca等）
7. 如需要，填入API密钥

### 步骤2：运行压测
1. 点击"开始测试"按钮
2. 系统会显示压测进度日志
3. 压测完成后会显示"正在跳转到结果页面..."
4. 自动在新标签页打开结果页面

### 步骤3：查看结果
1. 结果页面会显示加载动画
2. 加载完成后展示完整的压测报告
3. 包含测试配置、性能指标、图表和评级
4. 可以点击"导出报告"保存结果
5. 点击"返回测试"回到测试页面

## 技术特点

### 前端特性
- **响应式设计**：支持桌面和移动设备
- **实时图表**：使用Chart.js绘制专业图表
- **渐变背景**：美观的视觉效果
- **毛玻璃效果**：现代化的UI设计
- **动画效果**：流畅的交互体验

### 后端特性
- **CORS支持**：解决跨域问题
- **多后端支持**：兼容多种LLM服务
- **错误处理**：完善的错误处理机制
- **日志记录**：详细的操作日志
- **性能优化**：高效的请求处理

### 数据处理
- **实时计算**：动态计算性能指标
- **数据持久化**：使用localStorage保存结果
- **格式化输出**：标准化的JSON结果格式
- **评级算法**：智能的性能评级系统

## API接口

### 压测接口
```
POST /v1/benchmark
Content-Type: application/json

{
  "api_url": "http://localhost:8000/v1",
  "parallel": 3,
  "model": "model-name",
  "min-tokens": 50,
  "max-tokens": 100,
  "datasets": "openqa",
  "api_key": "optional-api-key"
}
```

### 响应格式
```json
{
  "status": "success",
  "metrics": {
    "total_requests": 100,
    "successful_requests": 98,
    "failed_requests": 2,
    "duration": 2.5,
    "requests_per_second": 39.2,
    "tokens_per_second": 3840,
    "avg_response_time": 0.65,
    "min_response_time": 0.2,
    "max_response_time": 1.8,
    "total_tokens": 9600
  },
  "percentiles": {
    "p50": 0.6,
    "p75": 0.8,
    "p90": 1.1,
    "p95": 1.4,
    "p99": 1.7
  }
}
```

## 故障排除

### 常见问题
1. **模型列表为空**：检查API URL是否正确，后端服务是否运行
2. **压测失败**：检查网络连接，API密钥是否正确
3. **结果页面空白**：检查浏览器控制台错误，清除localStorage
4. **图表不显示**：确保网络连接正常，Chart.js库加载成功

### 调试方法
1. 查看浏览器开发者工具的控制台
2. 检查网络请求是否成功
3. 查看服务器日志输出
4. 验证localStorage中的数据

## 扩展功能

### 自定义数据集
可以通过修改perf模块添加自定义数据集支持

### 更多图表类型
可以在结果页面添加更多类型的性能分析图表

### 历史记录
可以扩展功能保存和比较历史压测结果

### 批量测试
可以支持多个模型或配置的批量压测

## 总结

这个TPS压测系统提供了从配置到结果展示的完整流程，具有专业的性能分析能力和美观的用户界面。适合用于LLM服务的性能评估和优化工作。
